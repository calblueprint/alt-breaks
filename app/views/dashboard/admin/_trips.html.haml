#accordionOptions.accordion
  - cindex = 0
  - Trip.all.each do |trip|
    = render :partial=>'modals/add_trip_group', :locals => {:trip => trip}
    = render :partial=>'modals/add_community_partner', :locals => {:trip => trip}
    = render :partial=>'modals/edit_trip', :locals => {:trip => trip}
    .accordion-group
      .accordion-heading
        = link_to(trip[:name], "#collapse#{cindex}", :class=>"accordion-toggle", "data-toggle"=>"collapse", "data-parent"=>"accordionOptions" )
      .accordion-body.collapse{:id => "collapse#{cindex}"}
        .accordion-inner
          .row-fluid
            .span9
              %h4 Trip Groups
              %table.table.table-striped
                %thead
                  %tr
                    %th Date
                    %th Break Leaders
                    %th Status
                %tbody
                  - trip.trip_instances.all.each do |inst|
                    = render :partial=>'modals/add_break_leader', :locals => {:inst => inst}
                    %tr
                      %td #{link_to(inst[:season]+' '+inst[:year].to_s, trip_instance_path(inst[:id]))}
                      %td
                        - inst.break_leader_permissions.each do |permission|
                          - leader = permission.user
                          .small-well
                            .times
                              = link_to "x", permission, method: :delete, :confirm => "Are you sure you want to delete this break leader?"
                            = link_to leader.name, user_path(leader)

                        .small-well
                          %a{"data-toggle" => "modal", :href => "#leaderModal#{inst.id}", :role => "button"} +
                      %td
                        - if trip.current_trip_instance == inst
                          .btn.btn-danger Displayed
                        - else
                          = link_to "Display", change_current_path(trip.id, inst.id), :class=>"btn btn-primary"
                  %tr
                    %td{:colspan => 3}
                      %a.btn{"data-toggle" => "modal", :href => "#addInstance#{trip.id}", :role => "button"} Add Trip Group
            .span3
              .well
                %h5 Community Partners
                - trip.partners.all.each_slice(2) do |pset|
                  %ul.thumbnails
                  .row-fluid
                    - pset.each do |p|
                      %li.span3
                        .thumbnail
                          = link_to "x", dashboard_url, :class=>"btn btn-mini btn-danger", :confirm => "Are you sure you want to delete this community partner?"
                          - if p.logo.exists?
                            = link_to(image_tag(p.logo.url(:small)), "http://"+p.website)
                            = link_to p.name, "http://"+p.website
                          - else
                            = link_to(image_tag("/assets/community.jpg"), "http://"+p.website)
                            = link_to p.name, "http://"+p.website
                %a.btn.margin{"data-toggle" => "modal", :href => "#partnerModal#{trip.id}", :role => "button"} Add Partner
          %a.btn.btn-primary{"data-toggle" => "modal", :href => "#editTrip#{trip.id}", :role => "button"} Edit Trip
    - cindex += 1

%a.btn.btn-primary{"data-toggle" => "modal", :href => "#addTrip", :role => "button"} Add Trip
= render :partial=>'modals/add_trip'